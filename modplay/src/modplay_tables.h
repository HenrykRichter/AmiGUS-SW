#ifndef _INC_MODPLAY_TABLES_H
#define _INC_MODPLAY_TABLES_H

#define MTM_FINETUNE_STRIDE (64+68)
#define MTM_FINETUNE_IDXMASK 0 /* no finetuning (yet) */
#define PT_FINETUNE_STRIDE 37
#define PT_FINETUNE_IDXMASK 15

#define S3M_FINETUNE_STRIDE (12*9+1)
#define S3M_FINETUNE_IDXMASK 0 /* implicit finetuning */

#define OK_FINETUNE_STRIDE 37
#define OK_FINETUNE_IDXMASK 0

#ifndef MODPLAY_MAIN

extern const UBYTE PT_Vibrato_Tab[32];
extern const UWORD MTM_FineTune_Tab_[MTM_FINETUNE_STRIDE];
extern const UWORD PT_FineTune_Tab_[PT_FINETUNE_STRIDE*(PT_FINETUNE_IDXMASK+1)];
extern const UWORD S3M_FineTune_Tab_[S3M_FINETUNE_STRIDE];
extern const UWORD OK_FineTune_Tab_[OK_FINETUNE_STRIDE*(OK_FINETUNE_IDXMASK+1)];

#else

const UBYTE PT_Vibrato_Tab[32] =
{
 0,24,49,74,97,120,141,161,180,197,212,224,235,244,250,253,
 255,253,250,244,235,224,212,197,180,161,141,120,97,74,49,24
};


/* table adapted from FS3MDOC.TXT */
const UWORD S3M_FineTune_Tab_[S3M_FINETUNE_STRIDE] = {
//  C     C#    D     D#    E     F     F#    G     G#    A     A#    B
//─────────────────────────────────────────────────────────────────────────┐
27392,25856,24384,23040,21696,20480,19328,18240,17216,16256,15360,14496,// │ 0
13696,12928,12192,11520,10848,10240, 9664, 9120, 8608, 8128, 7680, 7248,// │ 1
 6848, 6464, 6096, 5760, 5424, 5120, 4832, 4560, 4304, 4064, 3840, 3624,// │ 2
 3424, 3232, 3048, 2880, 2712, 2560, 2416, 2280, 2152, 2032, 1920, 1812,// │ 3
 1712, 1616, 1524, 1440, 1356, 1280, 1208, 1140, 1076, 1016,  960,  906,// │ 4
  856,  808,  762,  720,  678,  640,  604,  570,  538,  508,  480,  453,// │ 5
  428,  404,  381,  360,  339,  320,  302,  285,  269,  254,  240,  226,// │ 6
  214,  202,  190,  180,  170,  160,  151,  143,  135,  127,  120,  113,// │ 7
  107,  101,   95,   90,   85,   80,   75,   71,   67,   63,   60,   56,// │ 8
  0
};


/* applies to MTM and some other PC trackers */
const UWORD MTM_FineTune_Tab_[MTM_FINETUNE_STRIDE] = {
	// very low freqs 
	27392,25856,24384,23040,21696,20480,19328,18240,17216,16256,15360,14496,
	13696,12928,12192,11520,10848,10240, 9664, 9120, 8608, 8128, 7680, 7248,
	 6848, 6464, 6096, 5760, 5424, 5120, 4832, 4560, 4304, 4064, 3840, 3624,
	 3424, 3232, 3048, 2880, 2712, 2560, 2416, 2280, 2152, 2032, 1920, 1812,

	// lower freqs
        808*2,762*2,720*2,678*2,640*2,604*2,570*2,
        538*2,508*2,480*2,453*2,
        // legacy PT
        856,808,762,720,678,640,604,570,538,508,480,453,
        428,404,381,360,339,320,302,285,269,254,240,226,
        214,202,190,180,170,160,151,143,135,127,120,113,
        // higher freqs (33 kHz...79.5kHz)
        214/2,202/2,190/2,180/2,170/2,160/2,151/2,143/2,
        135/2,127/2,120/2,113/2,
        214/4,202/4,190/4,180/4,
	// ultra high (85 kHz...255 kHz)
	42,   40,   37,   35,   33,   31,   30,   28,
	26,   25,   23,   22,   21,   20,   18,   17,   16,   15,   15,   14,0
};

const UWORD OK_FineTune_Tab_[OK_FINETUNE_STRIDE*(OK_FINETUNE_IDXMASK+1)] =
{
/*  C    C#     D    D#      E     F    F#     G    G#      A    A#     B */
 0x358,0x328,0x2FA,0x2D0, 0x2A6,0x280,0x25C,0x23A, 0x21A,0x1FC,0x1E0,0x1C5,
 0x1AC,0x194,0x17D,0x168, 0x153,0x140,0x12E,0x11D, 0x10D, 0xFE, 0xF0, 0xE2,
  0xD6, 0xCA, 0xBE, 0xB4,  0xAA, 0xA0, 0x97, 0x8F,  0x87, 0x7F, 0x78, 0x71,0
};


/* this table is a little different from the original Protracker
   table in an (internally) important detail: It is 0-terminated
   such that we can tolerate no-standard periods (notes) to be supplied
   in the mod. 

   Instead of comparing the notes table for equality, we
   can just search for the closest match (which implies equality
   for true PT mods). The table is in monotonously decreasing order 
   in any case.
*/
const UWORD PT_FineTune_Tab_[PT_FINETUNE_STRIDE*(PT_FINETUNE_IDXMASK+1)] = {
	856,808,762,720,678,640,604,570,538,508,480,453,
	428,404,381,360,339,320,302,285,269,254,240,226,
	214,202,190,180,170,160,151,143,135,127,120,113,0,
//
	850,802,757,715,674,637,601,567,535,505,477,450,
	425,401,379,357,337,318,300,284,268,253,239,225,
	213,201,189,179,169,159,150,142,134,126,119,113,0,
//
	844,796,752,709,670,632,597,563,532,502,474,447,
	422,398,376,355,335,316,298,282,266,251,237,224,
	211,199,188,177,167,158,149,141,133,125,118,112,0,
//
	838,791,746,704,665,628,592,559,528,498,470,444,
	419,395,373,352,332,314,296,280,264,249,235,222,
	209,198,187,176,166,157,148,140,132,125,118,111,0,
//
	832,785,741,699,660,623,588,555,524,495,467,441,
	416,392,370,350,330,312,294,278,262,247,233,220,
	208,196,185,175,165,156,147,139,131,124,117,110,0,
//
	826,779,736,694,655,619,584,551,520,491,463,437,
	413,390,368,347,328,309,292,276,260,245,232,219,
	206,195,184,174,164,155,146,138,130,123,116,109,0,
//
	820,774,730,689,651,614,580,547,516,487,460,434,
	410,387,365,345,325,307,290,274,258,244,230,217,
	205,193,183,172,163,154,145,137,129,122,115,109,0,
//
	814,768,725,684,646,610,575,543,513,484,457,431,
	407,384,363,342,323,305,288,272,256,242,228,216,
	204,192,181,171,161,152,144,136,128,121,114,108,0,
//
	907,856,808,762,720,678,640,604,570,538,508,480,
	453,428,404,381,360,339,320,302,285,269,254,240,
	226,214,202,190,180,170,160,151,143,135,127,120,0,
//
	900,850,802,757,715,675,636,601,567,535,505,477,
	450,425,401,379,357,337,318,300,284,268,253,238,
	225,212,200,189,179,169,159,150,142,134,126,119,0,
//
	894,844,796,752,709,670,632,597,563,532,502,474,
	447,422,398,376,355,335,316,298,282,266,251,237,
	223,211,199,188,177,167,158,149,141,133,125,118,0,
//
	887,838,791,746,704,665,628,592,559,528,498,470,
	444,419,395,373,352,332,314,296,280,264,249,235,
	222,209,198,187,176,166,157,148,140,132,125,118,0,
//
	881,832,785,741,699,660,623,588,555,524,494,467,
	441,416,392,370,350,330,312,294,278,262,247,233,
	220,208,196,185,175,165,156,147,139,131,123,117,0,
//
	875,826,779,736,694,655,619,584,551,520,491,463,
	437,413,390,368,347,328,309,292,276,260,245,232,
	219,206,195,184,174,164,155,146,138,130,123,116,0,
//
	868,820,774,730,689,651,614,580,547,516,487,460,
	434,410,387,365,345,325,307,290,274,258,244,230,
	217,205,193,183,172,163,154,145,137,129,122,115,0,
//
	862,814,768,725,684,646,610,575,543,513,484,457,
	431,407,384,363,342,323,305,288,272,256,242,228,
	216,203,192,181,171,161,152,144,136,128,121,114,0,
};

#if 0
/* this table is a little different from the original Protracker
   table in an (internally) important detail: It is 0-terminated
   such that we can tolerate no-standard periods (notes) to be supplied
   in the mod. 

   Instead of comparing the notes table for equality, we
   can just search for the closest match (which implies equality
   for true PT mods). The table is in monotonously decreasing order 
   in any case.
*/
static const UWORD PT_FineTune_Tab[16][37] =
{
	{856,808,762,720,678,640,604,570,538,508,480,453,
	428,404,381,360,339,320,302,285,269,254,240,226,
	214,202,190,180,170,160,151,143,135,127,120,113,0},

	{850,802,757,715,674,637,601,567,535,505,477,450,
	425,401,379,357,337,318,300,284,268,253,239,225,
	213,201,189,179,169,159,150,142,134,126,119,113,0},

	{844,796,752,709,670,632,597,563,532,502,474,447,
	422,398,376,355,335,316,298,282,266,251,237,224,
	211,199,188,177,167,158,149,141,133,125,118,112,0},

	{838,791,746,704,665,628,592,559,528,498,470,444,
	419,395,373,352,332,314,296,280,264,249,235,222,
	209,198,187,176,166,157,148,140,132,125,118,111,0},

	{832,785,741,699,660,623,588,555,524,495,467,441,
	416,392,370,350,330,312,294,278,262,247,233,220,
	208,196,185,175,165,156,147,139,131,124,117,110,0},

	{826,779,736,694,655,619,584,551,520,491,463,437,
	413,390,368,347,328,309,292,276,260,245,232,219,
	206,195,184,174,164,155,146,138,130,123,116,109,0},

	{820,774,730,689,651,614,580,547,516,487,460,434,
	410,387,365,345,325,307,290,274,258,244,230,217,
	205,193,183,172,163,154,145,137,129,122,115,109,0},

	{814,768,725,684,646,610,575,543,513,484,457,431,
	407,384,363,342,323,305,288,272,256,242,228,216,
	204,192,181,171,161,152,144,136,128,121,114,108,0},

	{907,856,808,762,720,678,640,604,570,538,508,480,
	453,428,404,381,360,339,320,302,285,269,254,240,
	226,214,202,190,180,170,160,151,143,135,127,120,0},

	{900,850,802,757,715,675,636,601,567,535,505,477,
	450,425,401,379,357,337,318,300,284,268,253,238,
	225,212,200,189,179,169,159,150,142,134,126,119,0},

	{894,844,796,752,709,670,632,597,563,532,502,474,
	447,422,398,376,355,335,316,298,282,266,251,237,
	223,211,199,188,177,167,158,149,141,133,125,118,0},

	{887,838,791,746,704,665,628,592,559,528,498,470,
	444,419,395,373,352,332,314,296,280,264,249,235,
	222,209,198,187,176,166,157,148,140,132,125,118,0},

	{881,832,785,741,699,660,623,588,555,524,494,467,
	441,416,392,370,350,330,312,294,278,262,247,233,
	220,208,196,185,175,165,156,147,139,131,123,117,0},

	{875,826,779,736,694,655,619,584,551,520,491,463,
	437,413,390,368,347,328,309,292,276,260,245,232,
	219,206,195,184,174,164,155,146,138,130,123,116,0},

	{868,820,774,730,689,651,614,580,547,516,487,460,
	434,410,387,365,345,325,307,290,274,258,244,230,
	217,205,193,183,172,163,154,145,137,129,122,115,0},

	{862,814,768,725,684,646,610,575,543,513,484,457,
	431,407,384,363,342,323,305,288,272,256,242,228,
	216,203,192,181,171,161,152,144,136,128,121,114,0},
};
#endif
#endif /* MODPLAY_MAIN */
#endif /* _INC_MODPLAY_TABLES_H */

